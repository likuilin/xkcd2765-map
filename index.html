<!doctype html>
<html>
  <head>
    <title>xkcd 2765 map</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
     integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
     crossorigin=""></script>

    <style type="text/css">
      html, body, #map {
        padding: 0px;
        margin: 0px;
        width: 100%;
        height: 100%;
        background-color: black;
      }
      .leaflet-tile {
        /*
        width: initial !important;
        height: initial !important;
        max-height: 1024px;
        max-width: 1024px;
        */
      }
      .tile-img {
        position: absolute;
        top: 0px;
        left: 0px;
      }
    </style>

    <script>
      // copy(JSON.stringify(Comic.voyager.tigl.layers.map(({opts: {rect, name, id}}) => ({rect, name, id}))))
      window.mapData = JSON.parse(`[{"rect":[-15588,121,-12308,3673],"name":"hollow-shell_Ink","id":"hollow-shell_Ink"},{"rect":[21245,-31414,21597,-31062],"name":"black-hole-3_Ink","id":"black-hole-3_Ink"},{"rect":[-404,-9202,6364,-2562],"name":"origin_Ink","id":"origin_Ink"},{"rect":[-802,-8834,6062,-4434],"name":"origin_Pointer","id":"origin_Pointer"},{"rect":[5693,-9260,6349,-8652],"name":"tiny-world_Ink","id":"tiny-world_Ink"},{"rect":[-10482,-4495,-9442,-3455],"name":"earth-roche_normal","id":"earth-roche_normal"},{"rect":[-10485,-4452,-9349,-3460],"name":"earth-roche_problem-1","id":"earth-roche_problem-1"},{"rect":[-10496,-4457,-9216,-3465],"name":"earth-roche_problem-2","id":"earth-roche_problem-2"},{"rect":[-9110,-4711,-8838,-4439],"name":"normal-moon_Ink","id":"normal-moon_Ink"},{"rect":[4694,3044,7430,5060],"name":"soccerfield_Ink","id":"soccerfield_Ink"},{"rect":[16686,-12259,19486,-10067],"name":"67p_Ink","id":"67p_Ink"},{"rect":[-7670,-30523,-326,-23051],"name":"uzumaki_Ink","id":"uzumaki_Ink"},{"rect":[11060,12812,12916,14956],"name":"platform-planet_Ink","id":"platform-planet_Ink"},{"rect":[-23218,18034,-7602,26962],"name":"earth-map_Ink","id":"earth-map_Ink"},{"rect":[-52706,-30889,-38850,-17273],"name":"gravity-earth_Ink","id":"gravity-earth_Ink"},{"rect":[17973,8997,22021,13029],"name":"gravity-qwantz_Layer 1","id":"gravity-qwantz_Layer 1"},{"rect":[16563,696,17491,1352],"name":"safetysat_Ink","id":"safetysat_Ink"},{"rect":[1633,13438,3569,14558],"name":"saturn_Ink","id":"saturn_Ink"},{"rect":[-47406,-61864,-40958,-57336],"name":"ring-1_Ink","id":"ring-1_Ink"},{"rect":[-40960,-68928,-24576,-57344],"name":"ring-2_Ink","id":"ring-2_Ink"},{"rect":[-24576,-71009,-8192,-60097],"name":"ring-3_Ink","id":"ring-3_Ink"},{"rect":[-8192,-70973,8192,-60157],"name":"ring-4_Ink","id":"ring-4_Ink"},{"rect":[8192,-68991,24576,-57343],"name":"ring-5_Ink","id":"ring-5_Ink"},{"rect":[24576,-61991,31216,-57335],"name":"ring-6_Ink","id":"ring-6_Ink"},{"rect":[-61770,-47348,-57338,-40948],"name":"ring-7_Ink","id":"ring-7_Ink"},{"rect":[-57344,-57344,-40960,-40960],"name":"ring-8_Ink","id":"ring-8_Ink"},{"rect":[-40960,-57344,-31536,-51600],"name":"ring-9_Ink","id":"ring-9_Ink"},{"rect":[15349,-57344,24581,-51712],"name":"ring-10_Ink","id":"ring-10_Ink"},{"rect":[24576,-57344,40960,-40960],"name":"ring-11_Ink","id":"ring-11_Ink"},{"rect":[40960,-47571,45616,-40947],"name":"ring-12_Ink","id":"ring-12_Ink"},{"rect":[-68776,-40960,-57336,-24576],"name":"ring-13_Ink","id":"ring-13_Ink"},{"rect":[-57344,-40960,-51520,-31328],"name":"ring-14_Ink","id":"ring-14_Ink"},{"rect":[35329,-40960,40961,-31760],"name":"ring-15_Ink","id":"ring-15_Ink"},{"rect":[40960,-40960,52624,-24576],"name":"ring-16_Ink","id":"ring-16_Ink"},{"rect":[-70939,-24576,-59963,-8192],"name":"ring-17_Ink","id":"ring-17_Ink"},{"rect":[43779,-24576,54739,-8192],"name":"ring-18_Ink","id":"ring-18_Ink"},{"rect":[-70948,-8192,-59892,8192],"name":"ring-19_Ink","id":"ring-19_Ink"},{"rect":[43722,-8192,54762,8192],"name":"ring-20_Ink","id":"ring-20_Ink"},{"rect":[-68748,8192,-57340,24576],"name":"ring-21_Ink","id":"ring-21_Ink"},{"rect":[-57344,14757,-51424,24581],"name":"ring-22_Ink","id":"ring-22_Ink"},{"rect":[35232,15164,40960,24588],"name":"ring-23_Ink","id":"ring-23_Ink"},{"rect":[40960,8192,52560,24576],"name":"ring-24_Ink","id":"ring-24_Ink"},{"rect":[-61638,24576,-57334,30752],"name":"ring-25_Ink","id":"ring-25_Ink"},{"rect":[-57344,24576,-40960,40960],"name":"ring-26_Ink","id":"ring-26_Ink"},{"rect":[-40960,35056,-31232,40960],"name":"ring-27_Ink","id":"ring-27_Ink"},{"rect":[14947,35170,24579,40962],"name":"ring-28_Ink","id":"ring-28_Ink"},{"rect":[24576,24576,40960,40960],"name":"ring-29_Ink","id":"ring-29_Ink"},{"rect":[40960,24576,45488,30992],"name":"ring-30_Ink","id":"ring-30_Ink"},{"rect":[-47127,40960,-40951,45296],"name":"ring-31_Ink","id":"ring-31_Ink"},{"rect":[-40960,40960,-24576,52336],"name":"ring-32_Ink","id":"ring-32_Ink"},{"rect":[-24576,43563,-8192,54571],"name":"ring-33_Ink","id":"ring-33_Ink"},{"rect":[-8192,43599,8192,54591],"name":"ring-34_Ink","id":"ring-34_Ink"},{"rect":[8192,40960,24576,52448],"name":"ring-35_Ink","id":"ring-35_Ink"},{"rect":[24576,40960,30944,45440],"name":"ring-36_Ink","id":"ring-36_Ink"},{"rect":[42768,-134096,59152,-117712],"name":"star-destroyer_a","id":"star-destroyer-a_a"},{"rect":[42768,-134096,59152,-117712],"name":"star-destroyer_b","id":"star-destroyer-a_b"},{"rect":[42768,-132502,59152,-118646],"name":"star-destroyer_c","id":"star-destroyer-a_c"},{"rect":[42768,-129302,57312,-117702],"name":"star-destroyer_d","id":"star-destroyer-a_d"},{"rect":[42768,-121802,59152,-117706],"name":"star-destroyer_e","id":"star-destroyer-a_e"},{"rect":[42768,-132448,59152,-121952],"name":"star-destroyer_f","id":"star-destroyer-a_f"},{"rect":[42768,-126990,59152,-120990],"name":"star-destroyer_g","id":"star-destroyer-a_g"},{"rect":[49019,-125677,59163,-121933],"name":"star-destroyer_h","id":"star-destroyer-a_h"},{"rect":[43506,-134096,59154,-122416],"name":"star-destroyer_i","id":"star-destroyer-a_i"},{"rect":[26384,-134096,42768,-117712],"name":"star-destroyer_a","id":"star-destroyer-b_a"},{"rect":[26384,-134096,42768,-117712],"name":"star-destroyer_b","id":"star-destroyer-b_b"},{"rect":[26384,-132502,42768,-118646],"name":"star-destroyer_c","id":"star-destroyer-b_c"},{"rect":[26384,-129302,40928,-117702],"name":"star-destroyer_d","id":"star-destroyer-b_d"},{"rect":[26384,-121802,42768,-117706],"name":"star-destroyer_e","id":"star-destroyer-b_e"},{"rect":[26384,-132448,42768,-121952],"name":"star-destroyer_f","id":"star-destroyer-b_f"},{"rect":[26384,-126990,42768,-120990],"name":"star-destroyer_g","id":"star-destroyer-b_g"},{"rect":[32635,-125677,42779,-121933],"name":"star-destroyer_h","id":"star-destroyer-b_h"},{"rect":[27122,-134096,42770,-122416],"name":"star-destroyer_i","id":"star-destroyer-b_i"},{"rect":[10000,-138192,26384,-121808],"name":"star-destroyer_a","id":"star-destroyer-c_a"},{"rect":[10000,-138192,26384,-121808],"name":"star-destroyer_b","id":"star-destroyer-c_b"},{"rect":[10000,-136598,26384,-122742],"name":"star-destroyer_c","id":"star-destroyer-c_c"},{"rect":[10000,-133398,24544,-121798],"name":"star-destroyer_d","id":"star-destroyer-c_d"},{"rect":[10000,-125898,26384,-121802],"name":"star-destroyer_e","id":"star-destroyer-c_e"},{"rect":[10000,-136544,26384,-126048],"name":"star-destroyer_f","id":"star-destroyer-c_f"},{"rect":[10000,-131086,26384,-125086],"name":"star-destroyer_g","id":"star-destroyer-c_g"},{"rect":[16251,-129773,26395,-126029],"name":"star-destroyer_h","id":"star-destroyer-c_h"},{"rect":[10738,-138192,26386,-126512],"name":"star-destroyer_i","id":"star-destroyer-c_i"},{"rect":[42768,-150480,59152,-134096],"name":"star-destroyer_a","id":"star-destroyer-d_a"},{"rect":[42768,-150480,59152,-134096],"name":"star-destroyer_b","id":"star-destroyer-d_b"},{"rect":[42768,-148886,59152,-135030],"name":"star-destroyer_c","id":"star-destroyer-d_c"},{"rect":[42768,-145686,57312,-134086],"name":"star-destroyer_d","id":"star-destroyer-d_d"},{"rect":[42768,-138186,59152,-134090],"name":"star-destroyer_e","id":"star-destroyer-d_e"},{"rect":[42768,-148832,59152,-138336],"name":"star-destroyer_f","id":"star-destroyer-d_f"},{"rect":[42768,-143374,59152,-137374],"name":"star-destroyer_g","id":"star-destroyer-d_g"},{"rect":[49019,-142061,59163,-138317],"name":"star-destroyer_h","id":"star-destroyer-d_h"},{"rect":[43506,-150480,59154,-138800],"name":"star-destroyer_i","id":"star-destroyer-d_i"},{"rect":[26384,-150480,42768,-134096],"name":"star-destroyer_a","id":"star-destroyer-e_a"},{"rect":[26384,-150480,42768,-134096],"name":"star-destroyer_b","id":"star-destroyer-e_b"},{"rect":[26384,-148886,42768,-135030],"name":"star-destroyer_c","id":"star-destroyer-e_c"},{"rect":[26384,-145686,40928,-134086],"name":"star-destroyer_d","id":"star-destroyer-e_d"},{"rect":[26384,-138186,42768,-134090],"name":"star-destroyer_e","id":"star-destroyer-e_e"},{"rect":[26384,-148832,42768,-138336],"name":"star-destroyer_f","id":"star-destroyer-e_f"},{"rect":[26384,-143374,42768,-137374],"name":"star-destroyer_g","id":"star-destroyer-e_g"},{"rect":[32635,-142061,42779,-138317],"name":"star-destroyer_h","id":"star-destroyer-e_h"},{"rect":[27122,-150480,42770,-138800],"name":"star-destroyer_i","id":"star-destroyer-e_i"},{"rect":[-6384,-134096,10000,-117712],"name":"star-destroyer_a","id":"star-destroyer-f_a"},{"rect":[-6384,-134096,10000,-117712],"name":"star-destroyer_b","id":"star-destroyer-f_b"},{"rect":[-6384,-132502,10000,-118646],"name":"star-destroyer_c","id":"star-destroyer-f_c"},{"rect":[-6384,-129302,8160,-117702],"name":"star-destroyer_d","id":"star-destroyer-f_d"},{"rect":[-6384,-121802,10000,-117706],"name":"star-destroyer_e","id":"star-destroyer-f_e"},{"rect":[-6384,-132448,10000,-121952],"name":"star-destroyer_f","id":"star-destroyer-f_f"},{"rect":[-6384,-126990,10000,-120990],"name":"star-destroyer_g","id":"star-destroyer-f_g"},{"rect":[-133,-125677,10011,-121933],"name":"star-destroyer_h","id":"star-destroyer-f_h"},{"rect":[-5646,-134096,10002,-122416],"name":"star-destroyer_i","id":"star-destroyer-f_i"},{"rect":[-22768,-138192,-6384,-121808],"name":"star-destroyer_a","id":"star-destroyer-g_a"},{"rect":[-22768,-138192,-6384,-121808],"name":"star-destroyer_b","id":"star-destroyer-g_b"},{"rect":[-22768,-136598,-6384,-122742],"name":"star-destroyer_c","id":"star-destroyer-g_c"},{"rect":[-22768,-133398,-8224,-121798],"name":"star-destroyer_d","id":"star-destroyer-g_d"},{"rect":[-22768,-125898,-6384,-121802],"name":"star-destroyer_e","id":"star-destroyer-g_e"},{"rect":[-22768,-136544,-6384,-126048],"name":"star-destroyer_f","id":"star-destroyer-g_f"},{"rect":[-22768,-131086,-6384,-125086],"name":"star-destroyer_g","id":"star-destroyer-g_g"},{"rect":[-16517,-129773,-6373,-126029],"name":"star-destroyer_h","id":"star-destroyer-g_h"},{"rect":[-22030,-138192,-6382,-126512],"name":"star-destroyer_i","id":"star-destroyer-g_i"},{"rect":[-39152,-138192,-22768,-121808],"name":"star-destroyer_a","id":"star-destroyer-h_a"},{"rect":[-39152,-138192,-22768,-121808],"name":"star-destroyer_b","id":"star-destroyer-h_b"},{"rect":[-39152,-136598,-22768,-122742],"name":"star-destroyer_c","id":"star-destroyer-h_c"},{"rect":[-39152,-133398,-24608,-121798],"name":"star-destroyer_d","id":"star-destroyer-h_d"},{"rect":[-39152,-125898,-22768,-121802],"name":"star-destroyer_e","id":"star-destroyer-h_e"},{"rect":[-39152,-136544,-22768,-126048],"name":"star-destroyer_f","id":"star-destroyer-h_f"},{"rect":[-39152,-131086,-22768,-125086],"name":"star-destroyer_g","id":"star-destroyer-h_g"},{"rect":[-32901,-129773,-22757,-126029],"name":"star-destroyer_h","id":"star-destroyer-h_h"},{"rect":[-38414,-138192,-22766,-126512],"name":"star-destroyer_i","id":"star-destroyer-h_i"},{"rect":[-22768,-121808,-6384,-105424],"name":"star-destroyer_a","id":"star-destroyer-i_a"},{"rect":[-22768,-121808,-6384,-105424],"name":"star-destroyer_b","id":"star-destroyer-i_b"},{"rect":[-22768,-120214,-6384,-106358],"name":"star-destroyer_c","id":"star-destroyer-i_c"},{"rect":[-22768,-117014,-8224,-105414],"name":"star-destroyer_d","id":"star-destroyer-i_d"},{"rect":[-22768,-109514,-6384,-105418],"name":"star-destroyer_e","id":"star-destroyer-i_e"},{"rect":[-22768,-120160,-6384,-109664],"name":"star-destroyer_f","id":"star-destroyer-i_f"},{"rect":[-22768,-114702,-6384,-108702],"name":"star-destroyer_g","id":"star-destroyer-i_g"},{"rect":[-16517,-113389,-6373,-109645],"name":"star-destroyer_h","id":"star-destroyer-i_h"},{"rect":[-22030,-121808,-6382,-110128],"name":"star-destroyer_i","id":"star-destroyer-i_i"},{"rect":[18482,-30964,20466,-25892],"name":"subway-planet_Decloaked","id":"subway-planet_Decloaked"},{"rect":[13966,-42026,30030,-25978],"name":"subway-planet_Ink","id":"subway-planet_Ink"},{"rect":[-47209,2630,-37017,12966],"name":"mbta_Ink","id":"mbta_Ink"},{"rect":[-42039,3697,-39255,6769],"name":"mbta_blue-line","id":"mbta_blue-line"},{"rect":[-47031,3421,-41223,9261],"name":"mbta_green-line","id":"mbta_green-line"},{"rect":[-43891,2992,-41219,9680],"name":"mbta_orange-line","id":"mbta_orange-line"},{"rect":[-44810,5484,-38570,13052],"name":"mbta_red-line","id":"mbta_red-line"},{"rect":[-55011,103838,-39987,120014],"name":"clickdrag-nw_clickdrag-nw","id":"clickdrag-nw_clickdrag-nw"},{"rect":[-40000,103616,-24384,120000],"name":"clickdrag-ne_clickdrag-ne","id":"clickdrag-ne_clickdrag-ne"},{"rect":[-55245,120000,-39997,135904],"name":"clickdrag-sw_clickdrag-sw","id":"clickdrag-sw_clickdrag-sw"},{"rect":[-40000,120000,-24384,135312],"name":"clickdrag-se_clickdrag-se","id":"clickdrag-se_clickdrag-se"},{"rect":[1399,-14521,1879,-13753],"name":"voyager-1_Ink","id":"voyager-1_Ink"},{"rect":[10552,-5747,10952,-4947],"name":"voyager-2_Ink","id":"voyager-2_Ink"},{"rect":[26193,-9506,27777,-7986],"name":"spider_Ink","id":"spider_Ink"},{"rect":[-3442,2097,-2370,3201],"name":"dark-matter_Ink","id":"dark-matter_Ink"},{"rect":[-21646,-10728,-16702,-4776],"name":"orb_Ink","id":"orb_Ink"},{"rect":[-30752,14019,-29632,14995],"name":"space-shuttle_Ink","id":"space-shuttle_Ink"},{"rect":[-12689,-30603,-11201,-29291],"name":"guitar-ship_Ink","id":"guitar-ship_Ink"},{"rect":[-20543,10296,-19343,12184],"name":"diffraction_Ink","id":"diffraction_Ink"},{"rect":[-7079,-74669,5385,-69853],"name":"end_Ink","id":"end_Ink"}]`);

      // copy(JSON.stringify(Comic.voyager.objects.map(({x1, x2, y1, y2, effect: {msg}, id}) => ({x: (x1+x2)/2, y: (y1+y2)/2, msg: msg || "(none)", type: id.split(":")[0]}))))
      window.objectsData = JSON.parse(`[{"x":-39212,"y":3476,"msg":"Blue line deactivated!","type":"mbta-token"},{"x":-19564,"y":19728,"msg":"Red line deactivated!","type":"mbta-token"},{"x":-11658,"y":-29682,"msg":"Orange line deactivated!","type":"mbta-token"},{"x":-9456,"y":-4022,"msg":"Green line deactivated!","type":"mbta-token"},{"x":-42750,"y":6624,"msg":"Welcome to MIT! You acquired a hyperdrive!","type":"upgrade-2"},{"x":18504,"y":-31012,"msg":"MIT Cloaking Device deactivated! Boston detected.","type":"mbta-token"},{"x":6374,"y":-9176,"msg":"Wheeee!","type":"message"},{"x":5974,"y":-9276,"msg":"You found a rock with neat stripes!","type":"message"},{"x":4496,"y":-8604,"msg":"You found a secret glade","type":"message"},{"x":3496,"y":-8874,"msg":"You found a holographic Charizard business card","type":"message"},{"x":1332,"y":-8814,"msg":"You found a tiny meteorite!","type":"message"},{"x":19240,"y":-10922,"msg":"'Some people believe that when the Earth appears in the sky, it's a harbinger of doom.'","type":"upgrade-2"},{"x":19442,"y":-12002,"msg":"You found a broken smoke machine","type":"upgrade"},{"x":6322,"y":-4172,"msg":"You found a 5G seagull","type":"message"},{"x":17712,"y":916,"msg":"You found a first of its kind","type":"message"},{"x":18298,"y":-10006,"msg":"'Anyone for  Scrabble later?'","type":"upgrade"},{"x":-31750,"y":-1564,"msg":"You found a handful of the quantum foam that makes up the fabric of space!","type":"upgrade"},{"x":-145621,"y":-16384,"msg":"It is very lonely out here","type":"upgrade"},{"x":-46824,"y":-17464,"msg":"You found a sunken treasure","type":"upgrade"},{"x":-50442,"y":-19212,"msg":"'The Yellowstone Super What?'","type":"upgrade"},{"x":26986,"y":-9052,"msg":"You found a friendly jumping spider","type":"upgrade"},{"x":-52068,"y":-26684,"msg":"Nutritional Facts - Serving Size: 1 Cloud, Total Calories: 0","type":"upgrade"},{"x":-40694,"y":-28606,"msg":"You captured the flag! You decide to leave it there, but it's yours.","type":"upgrade"},{"x":-38794,"y":-25522,"msg":"You found an eye in the sky","type":"message"},{"x":-2398,"y":-3512,"msg":"Nice flying!","type":"upgrade"},{"x":6250,"y":4050,"msg":"GOOOOOOOOAAAAAAAAALLLLLLLLLLLLL!!!","type":"upgrade"},{"x":5870,"y":4056,"msg":"GOOOOOOOOAAAAAAAAALLLLLLLLLLLLL!!!","type":"upgrade"},{"x":7430,"y":4046,"msg":"You found the 3 million point line","type":"upgrade"},{"x":2676,"y":-6324,"msg":"You found a DVD of The Core (2003)!","type":"message"},{"x":13112,"y":13578,"msg":"You found two Andalites, one canonical!","type":"upgrade"},{"x":17204,"y":632,"msg":"(none)","type":"upgrade"},{"x":16834,"y":-10690,"msg":"You found The Long Now Foundation's nickel paperweight containing an archive of every published Animorphs book!","type":"upgrade"},{"x":16938,"y":1398,"msg":"The more refined oil had a dinner engagement","type":"upgrade"},{"x":12140,"y":12782,"msg":"What a nice place for a ship to sit!","type":"upgrade"},{"x":-30502,"y":14030,"msg":"A little upgrade works wonders on fuel efficiency","type":"upgrade"},{"x":11326,"y":14472,"msg":"You found a friend","type":"upgrade"},{"x":62012,"y":-13082,"msg":"You found a needle in a haystack","type":"upgrade"},{"x":18268,"y":10076,"msg":"Today is a good day I think for space exploration","type":"upgrade"},{"x":19456,"y":9096,"msg":"You found a tiny pteranodon!","type":"message"},{"x":-3842,"y":-23310,"msg":"Exit Only","type":"message"},{"x":18042,"y":11220,"msg":"But what if gravity doesn't actually exist?","type":"upgrade"},{"x":-6198,"y":-27156,"msg":"'You're going the wrong way!'","type":"message"},{"x":-3954,"y":-26928,"msg":"You found a tree-filled grove and a nice spot for quiet contemplation","type":"upgrade-2"},{"x":-112196,"y":52384,"msg":"From here you can view the source of it all.","type":"message"},{"x":3096,"y":-5904,"msg":"Welcome to liminal space","type":"message"},{"x":26004,"y":-40968,"msg":"You get the feeling you're not in Kansas anymore","type":"upgrade"},{"x":21236,"y":-30530,"msg":"Transfer here for Mornington Crescent","type":"message"},{"x":18538,"y":-34838,"msg":"There is no parking in the white zone","type":"upgrade"},{"x":17282,"y":-38646,"msg":"The next stop is Interplanetary Terminal G","type":"upgrade"},{"x":22540,"y":-34588,"msg":"You feel accomplished","type":"upgrade"},{"x":-798,"y":-67948,"msg":"There is a way out","type":"upgrade"},{"x":24880,"y":-34016,"msg":"You found a brightly-lit billboard","type":"upgrade"},{"x":-40666,"y":104874,"msg":"The vehicle below gives you a boost","type":"upgrade"},{"x":28714,"y":-29844,"msg":"You found a hot dog","type":"upgrade"},{"x":-37462,"y":104676,"msg":"'We should turn back'","type":"upgrade"},{"x":-1142,"y":-62238,"msg":"Right lane must turn right","type":"message"},{"x":-2080,"y":-62324,"msg":"Left lane must turn left","type":"message"},{"x":-29062,"y":130054,"msg":"You found an expert at underwater ropes.","type":"upgrade"},{"x":6234,"y":-8842,"msg":"You found a cool bug!","type":"message"},{"x":6128,"y":-8682,"msg":"You found a pretty leaf!","type":"message"},{"x":4886,"y":-8554,"msg":"You found a normal-looking leaf!","type":"message"},{"x":700,"y":-7754,"msg":"You found a marsh wren!","type":"message"},{"x":-294,"y":-6390,"msg":"You found an orb wren!","type":"message"},{"x":222,"y":-4994,"msg":"The St. Louis arch is also known as the gateway to space.","type":"message"},{"x":31374,"y":-137260,"msg":"You found a perpetual motion fidget spinner!","type":"upgrade"},{"x":23244,"y":-26248,"msg":"You found a bottle of Coke Absolute Zero!","type":"upgrade"},{"x":-402,"y":-128270,"msg":"You found a vintage Juicero juicer!","type":"upgrade"},{"x":44474,"y":-143506,"msg":"You found an unread email. better leave it unread.","type":"message"},{"x":36780,"y":-134816,"msg":"You found a glass slipper with a glass foot in it!","type":"message"},{"x":2776,"y":13476,"msg":"You found a pair of platonic solids, not quite touching!","type":"upgrade"},{"x":-48358,"y":-29956,"msg":"You found a stick!","type":"message"},{"x":-11174,"y":-128714,"msg":"You found a lymphocyte!","type":"message"},{"x":-21358,"y":-111418,"msg":"You found a forged resume!","type":"message"},{"x":-44094,"y":-30138,"msg":"You found a steam calliope!","type":"upgrade"},{"x":828,"y":-9418,"msg":"You found a single grain of salt!","type":"message"},{"x":-27288,"y":111184,"msg":"You found a trisected angle!","type":"upgrade-2"},{"x":150,"y":-6142,"msg":"You found 11 squares packed into a larger square!","type":"message"},{"x":-17002,"y":-112374,"msg":"You found a serif!","type":"message"},{"x":22710,"y":-29984,"msg":"You found a beige electron!","type":"upgrade"},{"x":-29868,"y":107778,"msg":"You found an ant the size of Rhode Island!","type":"message"},{"x":51320,"y":-122978,"msg":"You found a Bursa of Fabricius!","type":"upgrade"},{"x":46446,"y":-134470,"msg":"You found a cluster of data points!","type":"message"},{"x":6048,"y":4248,"msg":"You found a sunspot!","type":"upgrade"},{"x":596,"y":-7478,"msg":"You found a tumbleweed!","type":"message"},{"x":2810,"y":14604,"msg":"You found a block of scandium!","type":"upgrade"},{"x":-13648,"y":1600,"msg":"You found a sixth lagrange point!","type":"upgrade"},{"x":45522,"y":-134448,"msg":"You found a premium subscription to food.net!","type":"message"},{"x":20642,"y":-39272,"msg":"You found $30 in Yahoo! cash!","type":"upgrade"},{"x":2142,"y":14236,"msg":"You found a really cool data point!","type":"message"},{"x":21216,"y":-40188,"msg":"You found a relativistic bowling ball!","type":"message"},{"x":-14076,"y":84,"msg":"You found a glass of heavy water!","type":"upgrade"},{"x":-49912,"y":-18788,"msg":"You found an asterisk. it doesn’t seem to refer to anything.","type":"message"},{"x":25322,"y":-31096,"msg":"You found a friendly cat!","type":"upgrade"},{"x":-70510,"y":-16560,"msg":"You found the platinum cylinder formerly used to define the kilogram!","type":"message"},{"x":-41238,"y":-27684,"msg":"You found a dna base pair!","type":"upgrade"},{"x":-46654,"y":-30722,"msg":"You found a sterile neutrino!","type":"message"},{"x":-17412,"y":45266,"msg":"You found a necklace of element samples whose symbols spell out your name (note: hopefully you are not named 'katherine' or 'Brandon')!","type":"message"},{"x":55534,"y":-131968,"msg":"You found two goats and a new car!","type":"message"},{"x":26710,"y":-38114,"msg":"You found a Cybiko® wireless handheld computer for teens (2000)!","type":"message"},{"x":4236,"y":-128790,"msg":"You found an out-of-control trolley!","type":"message"},{"x":12316,"y":14830,"msg":"You found baby shoes (and baby)!","type":"upgrade"},{"x":-8854,"y":-4682,"msg":"You found a wayward Roomba full of moondust!","type":"message"},{"x":46178,"y":-9710,"msg":"You found the gold crown Archimedes stole!","type":"upgrade-2"},{"x":26938,"y":-35246,"msg":"You found a handful of quantum foam!","type":"message"},{"x":-43018,"y":134754,"msg":"You found a pin with 17 angels dancing on it!","type":"message"},{"x":-7318,"y":-28492,"msg":"You found a single caffeine molecule!","type":"upgrade"},{"x":34432,"y":-126894,"msg":"You found a helium-238 nucleus!","type":"message"},{"x":36728,"y":-121306,"msg":"Hmmm.","type":"message"},{"x":-33036,"y":-56550,"msg":"A significant boost to the engines for a curious pilot","type":"upgrade-2"},{"x":1744,"y":-14240,"msg":"You found Voyager 1! Some of its great speed rubs off on you.","type":"upgrade-2"},{"x":10588,"y":-5286,"msg":"You found Voyager 2! Some of its great speed rubs off on you.","type":"upgrade-2"},{"x":5916,"y":-7130,"msg":"Be careful; this roller coaster can be disorienting!","type":"message"},{"x":-16414,"y":19032,"msg":"You found the Principality of Sealand!","type":"upgrade"},{"x":-18438,"y":19784,"msg":"You found the Heart of the Ocean! It was drifting around in space.","type":"message"},{"x":-18896,"y":-9808,"msg":"(none)","type":"upgrade"},{"x":-21716,"y":-7530,"msg":"You found a sensible cheese platter","type":"upgrade-2"},{"x":-14356,"y":22532,"msg":"You found a whale shark!","type":"message"},{"x":-19660,"y":19796,"msg":"You found a Rhode Island the size of an ant!","type":"upgrade"},{"x":-2964,"y":2032,"msg":"You found a delicate music box.","type":"upgrade"},{"x":-10468,"y":24808,"msg":"You found an icosahedral d10","type":"upgrade"},{"x":-48862,"y":-29812,"msg":"You found a secret leaf!","type":"message"},{"x":-45620,"y":-30432,"msg":"You found a pair of squirrel goggles!","type":"message"},{"x":-20432,"y":12208,"msg":"You found a hydrogen ion!","type":"message"},{"x":-19364,"y":11024,"msg":"You found a piece of coronium! Wait, no, iron.","type":"message"},{"x":-18104,"y":26662,"msg":"You found some microbial life!","type":"message"},{"x":-20696,"y":-9228,"msg":"You found a swatch pop-out wristwatch!","type":"message"},{"x":-29618,"y":14990,"msg":"You found a piece of space shuttle food!","type":"message"},{"x":-12288,"y":-30358,"msg":"You found a guitar pick!","type":"message"},{"x":21758,"y":10600,"msg":"You found a baby hedgehog!","type":"message"},{"x":-4858,"y":-28574,"msg":"You found a golden radio tuned to 1.618 MHz!","type":"message"},{"x":-2560,"y":-27296,"msg":"You found a scroll lock key!","type":"message"},{"x":-3494,"y":-26408,"msg":"You found a primordial black hole!","type":"message"},{"x":-4612,"y":-25432,"msg":"You found a cool pair of shoes with flames on the side!","type":"message"},{"x":-5676,"y":-25576,"msg":"You found an ink cartridge!","type":"message"},{"x":-5902,"y":-29230,"msg":"You found a podcast episode!","type":"message"},{"x":-928,"y":-28376,"msg":"You found a festive but somehow unnerving holiday card from Junji Ito!","type":"message"},{"x":-2332,"y":-24510,"msg":"You found a friendly bee!","type":"message"},{"x":-2134,"y":-28246,"msg":"You found a spiral-cut diamond!","type":"message"},{"x":-2692,"y":-25636,"msg":"You found a burrito!","type":"message"},{"x":19948,"y":12446,"msg":"You found a tattered knapsack containing about $194,000 in $20 bills!","type":"message"},{"x":-19564,"y":-111028,"msg":"You found the Death Star plans!","type":"message"},{"x":-11600,"y":21954,"msg":"You found some tin from the pantai remis mine!","type":"message"},{"x":26982,"y":-8010,"msg":"You found a spider-silk scarf!","type":"message"},{"x":-10290,"y":22606,"msg":"You found a sparkling gem!","type":"message"},{"x":-10234,"y":18952,"msg":"You found a piece of pumice floating in space!","type":"message"},{"x":-9576,"y":-3668,"msg":"You found a curious humboldt squid!","type":"message"},{"x":-41438,"y":7454,"msg":"You found a strangely heavy subway token!","type":"message"},{"x":27124,"y":-31810,"msg":"You found a normal-sized apple!","type":"message"},{"x":-10350,"y":-3592,"msg":"You found a bathyscaphe at the Marianas Trench!","type":"message"},{"x":-52260,"y":-22162,"msg":"You found a large hadron!","type":"message"},{"x":-39884,"y":-21122,"msg":"You found a smooth green snake! It curls up in your hand and naps.","type":"message"}]`);
    </script>

    <script>
      window.onload = () => {
        // extend TileLayer to support grid origin, and to support partial images (otherwise it stretches)
        const CustomLayer = L.TileLayer.extend({
          options: {
            gridOrigin: undefined
          },

          // sanity checks in _update
          _update(...args) {
            if (!(this.options.gridOrigin instanceof L.Point)) throw new Error("gridOrigin must be set");
            if (this._map.options.crs.wrapLng || this._map.options.crs.wrapLat) {
              // to support wrap, override math in _resetGrid to add gridOrigin
              throw new Error("wrap unsupported");
            }
            return L.TileLayer.prototype._update.call(this, ...args);
          },

          // https://github.com/Leaflet/Leaflet/blob/26f7df877bb06da1e1b1e890715eb06703e3710e/src/layer/tile/GridLayer.js#L748
          _tileCoordsToNwSe(coords) {
            const scaledGridOrigin = this.options.gridOrigin.scaleBy(L.point(2**this._tileZoom, 2**this._tileZoom));
            const map = this._map,
                tileSize = this.getTileSize(),
                nwPoint = coords.scaleBy(tileSize).subtract(scaledGridOrigin),
                sePoint = nwPoint.add(tileSize),
                nw = map.unproject(nwPoint, coords.z),
                se = map.unproject(sePoint, coords.z);
            return [nw, se];
          },

          // https://github.com/Leaflet/Leaflet/blob/26f7df877bb06da1e1b1e890715eb06703e3710e/src/layer/tile/GridLayer.js#L894
          _getTilePos(coords) {
            const scaledGridOrigin = this.options.gridOrigin.scaleBy(L.point(2**this._tileZoom, 2**this._tileZoom));
            return coords.scaleBy(this.getTileSize()).subtract(scaledGridOrigin).subtract(this._level.origin);
          },

          // https://github.com/Leaflet/Leaflet/blob/26f7df877bb06da1e1b1e890715eb06703e3710e/src/layer/tile/GridLayer.js#L906
          _pxBoundsToTileRange(bounds) {
            const scaledGridOrigin = this.options.gridOrigin.scaleBy(L.point(2**this._tileZoom, 2**this._tileZoom));
            const tileSize = this.getTileSize();
            return new L.Bounds(
              bounds.min.add(scaledGridOrigin).unscaleBy(tileSize).floor(),
              bounds.max.add(scaledGridOrigin).unscaleBy(tileSize).ceil().subtract([1, 1]));
          },

          // rotate 180 degrees with an intermediary element
          createTile: function (...args) {
            const tile = document.createElement('div');
            if (false) { // debug image coords without loading images
              tile.style.outline = '5px solid green';
              tile.style.color = 'red';
              tile.style.fontWeight = 'bold';
              tile.style.fontSize = '50pt';
              tile.innerText = this.getTileUrl(args[0]).split("/").slice(-3).join("/");
            } else {
              const elem = L.TileLayer.prototype.createTile.call(this, ...args);
              elem.className = "tile-img";
              tile.appendChild(elem);
            }
            return tile;
          },

          getTileUrl(coords) {
            const data = {
              s: this._getSubdomain(coords),
              x: coords.x,
              y: coords.y,
              z: -this._getZoomForUrl()
            };
            if (this._map && !this._map.options.crs.infinite) {
              const invertedY = this._globalTileRange.max.y - coords.y;
              if (this.options.tms) {
                data['y'] = invertedY;
              }
              data['-y'] = invertedY;
            }

            return L.Util.template(this._url, L.Util.extend(data, this.options));
          },
        });
        
        const maxBounds = L.latLngBounds([0, 0], [0, 0]);
        const map = L.map("map", {
          crs: L.CRS.Simple,
          minZoom: -9,
        });

        const mapLayers = {};
        for (const mapZone of window.mapData) {
          let layerName = mapZone.name.split('_').pop();

          // there's 81 layers for the star destroyer but only the ones where the suffix matches the layer name are displayed at all
          // not sure if there's more to find or if this is just something left in accidentally (seems like they're always isHidden=true)
          if (mapZone.id.startsWith('star-destroyer-')) {
            const id = mapZone.id.split('-').pop().split('_');
            if (id.length === 2 && id[0] !== id[1]) continue;
            layerName = 'star-destroyer';
          }
          if (!mapLayers[layerName]) {
            mapLayers[layerName] = L.layerGroup();
            // initially enabled layers correspond to start state of game
            if (['Ink', 'problem-1', 'Layer 1', 'star-destroyer'].includes(layerName) ||
                layerName.endsWith('-line') || layerName.startsWith('clickdrag-')) mapLayers[layerName].addTo(map);
          }

          const [ymin, xmin, ymax, xmax] = mapZone.rect;
          // const tileBounds = [[mapZone.rect[1], mapZone.rect[0]],[mapZone.rect[3], mapZone.rect[2]]];
          const tileBounds = [[-xmax, ymin], [-xmin, ymax]];
          maxBounds.extend(tileBounds);

          /*
          L.imageOverlay("https://upload.wikimedia.org/wikipedia/commons/6/68/Orange_tabby_cat_sitting_on_fallen_leaves-Hisashi-01A.jpg",
            tileBounds
          ).setStyle({
            opacity: 0.5
          }).addTo(map);
          */

          // original url 'https://xkcd.com/2765/assets/0/tile/' + mapZone.name + '_{x}_{y}_img.png'
          (new CustomLayer('imgs/{z}/' + mapZone.name + '/{x}_{y}.png', {
            minNativeZoom: -4,
            maxNativeZoom: 0,
            edgeBufferTiles: 2,
            minZoom: -100,
            maxZoom: 0,
            tileSize: 1024,
            bounds: tileBounds,
            gridOrigin: L.point(-ymin, -xmin), // top left corner aligned, that's lat=-ymin and long=-xmin
            attribution: 'images from <a href="https://xkcd.com/2765/" target="_blank">xkcd 2765</a> | map by <a href="https://kuilin.net/" target="_blank">kuilin</a> | source <a href="https://github.com/likuilin/xkcd2765-map" target="_blank">on github</a>',
            errorTileUrl: 'imgs/empty.png'
          })).addTo(mapLayers[layerName]);

          if (mapZone.name === "tiny-world_Ink") map.fitBounds(tileBounds);
        }
        L.control.layers({}, mapLayers).addTo(map);
        map.setView([7768, 5412]); // [-Comic.voyager.tickState.y, Comic.voyager.tickState.x]
        map.setZoom(-1);
        // map.setMaxBounds(maxBounds);

        // thanks to https://github.com/pointhi/leaflet-color-markers for icons
        const iconData = {
          shadowUrl: 'imgs/marker-shadow.png',
          iconSize: [25, 41],
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        };
        const objIcons = {
          "message": L.icon({iconUrl: 'imgs/marker-icon-2x-blue.png', ...iconData}),
          "upgrade": L.icon({iconUrl: 'imgs/marker-icon-2x-gold.png', ...iconData}),
          "upgrade-2": L.icon({iconUrl: 'imgs/marker-icon-2x-violet.png', ...iconData}),
          "mbta-token": L.icon({iconUrl: 'imgs/marker-icon-2x-orange.png', ...iconData})
        };

        // split markers into separate LayerGroups
        const markerLayers = window.objectsData.reduce((result, obj) => {
          if (!result[obj.type]) {
            result[obj.type] = L.layerGroup().addTo(map);
          }
          L.marker([-obj.y, obj.x], {
            icon: objIcons[obj.type],
            title: obj.msg
          }).addTo(result[obj.type]).on('click', ()=>alert("type: " + obj.type + "\nmsg: " + obj.msg));
          return result;
        }, {});

        // add layer control
        L.control.layers({}, markerLayers).addTo(map);
      };
    </script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>

